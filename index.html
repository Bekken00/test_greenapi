<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenAPI test site</title>
    <style>
        * {
            box-sizing: border-box;
        }

        main {
            margin-inline: 20%;
            display: flex;
        }

        .interactive-container {
            width: 50%;
            padding: 10px;
        }

        .answer-container {
            width: 50%;
        }

        .answer {
            border: 1px solid black;
            width: 100%;
            min-height: 100px;
            padding: 10px;
            height: 80vh;
        }

        input {
            width: 90%;
            padding: 5px;
            margin-bottom: 10px;
        }

        button {
            width: 90%;
            padding: 12px;
            margin-top: 10px;
        }

        pre {
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <main>
        <div class="interactive-container">

            <input type="text" name="idInstance" id="idInstance"  placeholder="idInstance">
            <input type="text" name="apiTokenInstance" id="apiTokenInstance" placeholder="ApiTokenInstance">
            <button type="button" onclick="getSettings()">
                getSettings
            </button>
            <button type="button" onclick="getStateInstance()">
                getStateInstance
            </button><br><br><br><br>

            <input type="text" name="phoneNumberMessage" id="phoneNumberMessage" placeholder="phoneNumber">
            <input type="text" name="message" id="message" placeholder="message">
            <button type="button" onclick="sendMessage()">
                sendMessage
            </button><br><br><br><br>

            <input type="text" name="phoneNumberFile" id="phoneNumberFile" placeholder="phoneNumber">
            <input type="text" name="urlFile" id="urlFile" placeholder="urlFile">
            <button type="button" onclick="sendFileByUrl()">
                sendFileByUrl
            </button>

        </div>
        <div class="answer-container">
            <h3>Ответ:</h3>
            <pre class="answer" name="answer" id="answer"></pre>
        </div>
    </main>

    <script>
        const apiUrl = "https://7105.api.greenapi.com";
        const mediaUrl = "https://7105.media.greenapi.com";
        const idInstance = document.getElementById("idInstance");
        const apiTokenInstance = document.getElementById("apiTokenInstance");

        async function getSettings() {
            const url = `${apiUrl}/waInstance${idInstance.value}/getSettings/${apiTokenInstance.value}`;
            const res = await fetch(url);
            const data = await res.json();

            document.getElementById("answer").textContent = JSON.stringify(data, null, 2);
        }

        async function getStateInstance() {
            const url = `${apiUrl}/waInstance${idInstance.value}/getStateInstance/${apiTokenInstance.value}`;
            const res = await fetch(url);
            const data = await res.json();

            document.getElementById("answer").textContent = JSON.stringify(data, null, 2);
        }

        async function sendMessage() {
            const phoneNumber = document.getElementById("phoneNumberMessage");
            const message = document.getElementById("message");

            const res = await fetch(`${apiUrl}/waInstance${idInstance.value}/sendMessage/${apiTokenInstance.value}`, {
                method: "POST",
                body: JSON.stringify({ 
                    chatId: `${phoneNumber.value}@c.us`,
                    message: `${message.value}`
                })
            });
            const data = await res.json();

            document.getElementById("answer").textContent = JSON.stringify(data, null, 2);
        }

        async function sendFileByUrl() {
            const phoneNumber = document.getElementById("phoneNumberFile");
            const urlFile = document.getElementById("urlFile");
            const res = await fetch(`${apiUrl}/waInstance${idInstance.value}/sendFileByUrl/${apiTokenInstance.value}`, {
                method: "POST",
                body: JSON.stringify({
                    chatId: `${phoneNumber.value}@c.us`,
                    urlFile: urlFile.value, 
                    fileName: "test.jpeg"
                })
            });
            const data = await res.json();

            document.getElementById("answer").textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>